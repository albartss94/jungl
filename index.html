<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jungl - Discover New Music</title>
    <style>
        /* ============  GLOBAL STYLES  ============ */
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
            background:#0a0a0a;min-height:100vh;display:flex;flex-direction:column;align-items:center;color:#fff;overflow:hidden}
        /* --- header / branding ------------------------------------------------ */
        .header{background:rgba(255,255,255,.05);backdrop-filter:blur(20px);
            width:100%;padding:20px;display:flex;align-items:center;justify-content:space-between;
            border-bottom:1px solid rgba(255,255,255,.1)}
        .logo-section{display:flex;align-items:center;gap:15px}
        .logo{width:40px;height:40px;position:relative}
        .logo svg{width:100%;height:100%}
        .brand-name{font-size:24px;font-weight:700;letter-spacing:-1px;
            background:linear-gradient(135deg,#1DB954 0%,#1ed760 100%);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .tagline{font-size:12px;opacity:.7;margin-top:2px}
        /* --- buttons / avatar -------------------------------------------------- */
        .login-section{display:flex;gap:15px;align-items:center}
        .login-button{background:#1DB954;color:#fff;border:none;padding:10px 24px;border-radius:20px;
            font-size:14px;font-weight:600;cursor:pointer;transition:.3s;display:flex;align-items:center;gap:8px}
        .login-button:hover{background:#1ed760;transform:translateY(-1px)}
        .user-info{display:none;align-items:center;gap:15px}
        .user-avatar{width:35px;height:35px;border-radius:50%;
            background:linear-gradient(135deg,#1DB954 0%,#1ed760 100%)}
        /* --- main container ---------------------------------------------------- */
        .app-container{max-width:400px;width:90%;margin-top:30px;flex:1;
            display:flex;flex-direction:column;position:relative}
        .login-prompt{background:rgba(255,255,255,.05);backdrop-filter:blur(20px);
            border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:60px 40px;
            text-align:center;margin-top:100px}
        .login-prompt h2{font-size:28px;margin-bottom:15px;
            background:linear-gradient(135deg,#1DB954 0%,#1ed760 100%);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .login-prompt p{opacity:.8;margin-bottom:30px;line-height:1.6}
        .spotify-login-btn{background:#1DB954;color:#fff;border:none;padding:15px 40px;border-radius:30px;
            font-size:16px;font-weight:600;cursor:pointer;transition:.3s;display:inline-flex;align-items:center;gap:10px}
        .spotify-login-btn:hover{background:#1ed760;transform:translateY(-2px);
            box-shadow:0 10px 30px rgba(29,185,84,.3)}
        /* --- swipe-card stack --------------------------------------------------- */
        .card-stack{position:relative;height:600px;margin-bottom:20px;display:none}
        .card-stack.active{display:block}
        .card{position:absolute;width:100%;height:100%;
            background:rgba(255,255,255,.05);backdrop-filter:blur(20px);
            border:1px solid rgba(255,255,255,.1);border-radius:20px;cursor:grab;
            transition:transform .2s ease-out,opacity .2s ease-out;overflow:hidden}
        .card.dragging{transition:none;cursor:grabbing}
        .card.swiped-right{transform:translateX(150%) rotate(30deg);opacity:0}
        .card.swiped-left{transform:translateX(-150%) rotate(-30deg);opacity:0}
        .card-content{height:100%;display:flex;flex-direction:column;position:relative}
        .album-art{width:100%;height:60%;background:linear-gradient(135deg,#1a1a1a 0%,#2a2a2a 100%);
            display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
        .album-art img{width:100%;height:100%;object-fit:cover}
        .album-art .placeholder{font-size:80px;opacity:.2}
        /* --- mini-audio player -------------------------------------------------- */
        .audio-player{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);
            background:rgba(0,0,0,.8);padding:15px 30px;border-radius:30px;display:flex;align-items:center;gap:15px;
            backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1)}
        .play-button{width:40px;height:40px;background:#1DB954;border:none;border-radius:50%;cursor:pointer;
            display:flex;align-items:center;justify-content:center;transition:.3s;color:#fff}
        .play-button:hover{background:#1ed760;transform:scale(1.1)}
        .play-button:active{transform:scale(.95)}
        .progress-bar{width:150px;height:4px;background:rgba(255,255,255,.2);border-radius:2px;overflow:hidden}
        .progress{height:100%;background:#1DB954;width:0%;transition:width .1s linear}
        .time-display{color:#fff;font-size:12px;font-weight:500}
        /* --- song meta ---------------------------------------------------------- */
        .song-info{padding:30px;flex:1;display:flex;flex-direction:column;justify-content:center}
        .song-info h2{font-size:24px;margin-bottom:10px;color:#fff}
        .song-info .artist{font-size:18px;color:#aaa;margin-bottom:5px}
        .song-info .genre{font-size:14px;color:#666;margin-bottom:20px}
        .song-info .popularity{display:flex;align-items:center;gap:10px;font-size:14px;color:#aaa}
        .popularity-bar{width:100px;height:6px;background:rgba(255,255,255,.1);border-radius:3px;overflow:hidden}
        .popularity-fill{height:100%;background:linear-gradient(90deg,#1DB954,#1ed760);width:0%;transition:width 1s ease-out}
        /* --- like / dislike buttons -------------------------------------------- */
        .action-buttons{display:flex;justify-content:center;gap:40px;margin-bottom:20px}
        .action-button{width:60px;height:60px;border-radius:50%;border:2px solid;cursor:pointer;transition:.3s;
            display:flex;align-items:center;justify-content:center;font-size:24px;
            background:rgba(255,255,255,.05);backdrop-filter:blur(20px)}
        .action-button:hover{transform:scale(1.1)}
        .action-button:active{transform:scale(.95)}
        .dislike-button{border-color:#ff4458;color:#ff4458}
        .dislike-button:hover{background:#ff4458;color:#fff}
        .like-button{border-color:#1DB954;color:#1DB954}
        .like-button:hover{background:#1DB954;color:#fff}
        /* --- swipe indicators --------------------------------------------------- */
        .love-indicator,.nope-indicator{position:absolute;top:50%;transform:translateY(-50%) rotate(-30deg);
            font-size:60px;font-weight:bold;padding:10px 30px;border-radius:10px;border:4px solid;opacity:0;transition:.2s}
        .love-indicator{right:20px;color:#1DB954;border-color:#1DB954}
        .nope-indicator{left:20px;color:#ff4458;border-color:#ff4458}
        /* --- misc --------------------------------------------------------------- */
        .stats{background:rgba(255,255,255,.05);backdrop-filter:blur(20px);padding:15px;border-radius:15px;text-align:center;
            font-size:14px;margin-top:10px;border:1px solid rgba(255,255,255,.1)}
        .loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
        .loading-spinner{width:50px;height:50px;border:3px solid rgba(255,255,255,.1);border-top-color:#1DB954;
            border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .info-section{background:rgba(255,255,255,.05);backdrop-filter:blur(20px);
            border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:30px;margin-top:40px;text-align:center}
        .info-section h3{color:#1DB954;margin-bottom:15px}
        .info-section p{opacity:.8;line-height:1.6;margin-bottom:10px}
        .code-block{background:rgba(0,0,0,.5);padding:15px;border-radius:10px;font-family:'Courier New',monospace;
            font-size:14px;margin:15px 0;border:1px solid rgba(255,255,255,.1)}
    </style>
</head>
<body>
    <!-- ======================= HEADER ======================= -->
    <div class="header">
        <div class="logo-section">
            <div class="logo">
                <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="junglGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1DB954"/>
                            <stop offset="100%" style="stop-color:#1ed760"/>
                        </linearGradient>
                    </defs>
                    <path d="M20 5L35 15v10L20 35 5 25V15Z" fill="url(#junglGradient)"/>
                    <path d="M20 12l7 5v6l-7 5-7-5v-6Z" fill="#0a0a0a"/>
                    <circle cx="20" cy="20" r="3" fill="url(#junglGradient)"/>
                </svg>
            </div>
            <div>
                <div class="brand-name">jungl</div>
                <div class="tagline">Discover your sound</div>
            </div>
        </div>
        <div class="login-section" id="loginSection">
            <button class="login-button" id="headerLoginBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                    <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm0 3a3 3 0 1 1-3 3 3.003 3.003 0 0 1 3-3Zm0 14.2a7.193 7.193 0 0 1-6-3.22c.03-2 3.99-3.08 6-3.08s5.97 1.09 6 3.08a7.192 7.192 0 0 1-6 3.22Z"/>
                </svg>
                Connect Spotify
            </button>
        </div>
        <div class="user-info" id="userInfo">
            <span id="userName">User</span>
            <div class="user-avatar"></div>
        </div>
    </div>

    <!-- ======================= MAIN ======================== -->
    <div class="app-container">
        <!-- welcome block -->
        <div class="login-prompt" id="loginPrompt">
            <h2>Welcome to Jungl</h2>
            <p>Discover new music that matches your vibe. Connect your Spotify account to start swiping through fresh tracks and build your perfect playlist.</p>
            <button class="spotify-login-btn" id="mainLoginBtn">
                <!-- spotify glyph -->
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0Zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02Zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2Zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3Z"/>
                </svg>
                Connect with Spotify
            </button>
        </div>

        <!-- swipe stack -->
        <div class="card-stack" id="cardStack">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading your music...</p>
            </div>
        </div>

        <!-- like / dislike -->
        <div class="action-buttons" id="actionButtons" style="display:none">
            <button class="action-button dislike-button" id="dislikeBtn">âœ•</button>
            <button class="action-button like-button"    id="likeBtn">â™¥</button>
        </div>

        <!-- counters -->
        <div class="stats" id="stats" style="display:none">
            <span id="likedCount">0</span> songs liked â€¢ <span id="totalCount">0</span> songs heard
        </div>

        <!-- demo info -->
        <div class="info-section" id="infoSection" style="display:none">
            <h3>ðŸŽµ Demo Mode</h3>
            <p>This is currently running in demo mode with sample tracks.</p>
            <p>To connect real Spotify music, you'll need:</p>
            <div class="code-block">
                1. Spotify Developer Account<br>
                2. Client ID &amp; Client Secret<br>
                3. Backend server for OAuth<br>
                4. Deployed web app with HTTPS
            </div>
            <p>Get started at <strong>developer.spotify.com</strong></p>
        </div>
    </div>

    <!-- ======================= SCRIPT ====================== -->
    <script>
/* ------------------------------------------------------------------ */
/* 0. CONSTANTS                                                        */
/* ------------------------------------------------------------------ */
const SPOTIFY_CLIENT_ID = '564aa538caf242638e9f895679012e50';
const REDIRECT_URI      = 'https://albartss94.github.io/jungl/';
const SPOTIFY_AUTH_URL  = 'https://accounts.spotify.com/authorize';
const SPOTIFY_TOKEN_URL = 'https://accounts.spotify.com/api/token';
const SPOTIFY_API_BASE  = 'https://api.spotify.com/v1';

/* scopes intentionally left blank for STEP-2 */
const SPOTIFY_SCOPES = [];

/* ------------------------------------------------------------------ */
/* 1. HELPER FUNCTIONS                                                 */
/* ------------------------------------------------------------------ */
function generateRandomString(len){
    const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    const rand = crypto.getRandomValues(new Uint8Array(len));
    return rand.reduce((acc,x)=>acc+chars[x%chars.length],'');
}
async function sha256(plain){
    const data=new TextEncoder().encode(plain);
    return crypto.subtle.digest('SHA-256',data);
}
function base64encode(buf){
    return btoa(String.fromCharCode(...new Uint8Array(buf)))
           .replace(/=/g,'').replace(/\+/g,'-').replace(/\//g,'_');
}

/* ------------------------------------------------------------------ */
/* 2.  >>>>>>>  CHANGED FUNCTION  <<<<<<                               */
/* ------------------------------------------------------------------ */
async function initiateSpotifyLogin(){
    /* PKCE verifier / challenge */
    const codeVerifier = generateRandomString(64);
    sessionStorage.setItem('code_verifier',codeVerifier);
    const codeChallenge = base64encode(await sha256(codeVerifier));

    /* CSRF state */
    const state = generateRandomString(16);
    sessionStorage.setItem('spotify_oauth_state',state);

    /* assemble query */
    const params = {
        response_type:'code',
        client_id:    SPOTIFY_CLIENT_ID,
        redirect_uri: REDIRECT_URI,
        code_challenge_method:'S256',
        code_challenge:       codeChallenge,
        state: state,
        scope:''                 /* no scopes yet */
    };
    const authUrl = `${SPOTIFY_AUTH_URL}?${new URLSearchParams(params)}`;

    /* STEP-2 behaviour: only log */
    console.log('Copy this URL into a new tab âžœ',authUrl);
    // window.location.href = authUrl;  <-- enable in Step 3
}

/* ------------------------------------------------------------------ */
/* 3.  MOCK SONG DATA (unchanged)                                      */
/* ------------------------------------------------------------------ */
const mockSongs=[ /* â€¦ same five demo tracks as before â€¦ */ ];
/* -------------  (content omitted for brevity) ---------------------- */

/* ------------------------------------------------------------------ */
/* 4.  APP-STATE VARIABLES & DOM REFS (unchanged)                      */
/* ------------------------------------------------------------------ */
let currentSongIndex=0,likedSongs=[],currentAudio=null,isPlaying=false,
    progressInterval=null,isLoggedIn=false,accessToken=null,
    spotifySongs=[],junglPlaylistId=null,likedCount=0,totalCount=0;

const cardStack     = document.getElementById('cardStack');
const likeBtn       = document.getElementById('likeBtn');
const dislikeBtn    = document.getElementById('dislikeBtn');
const likedCountEl  = document.getElementById('likedCount');
const totalCountEl  = document.getElementById('totalCount');
const loginPrompt   = document.getElementById('loginPrompt');
const actionButtons = document.getElementById('actionButtons');
const stats         = document.getElementById('stats');
const infoSection   = document.getElementById('infoSection');

/* ------------------------------------------------------------------ */
/* 5.  INITIALISATION (unchanged)                                      */
/* ------------------------------------------------------------------ */
window.addEventListener('load',async()=>{
    document.getElementById('headerLoginBtn').addEventListener('click',initiateSpotifyLogin);
    document.getElementById('mainLoginBtn').addEventListener('click',initiateSpotifyLogin);

    const code=new URLSearchParams(location.search).get('code');
    if(code){await handleAuthCallback(code);return;}

    const stored= sessionStorage.getItem('spotify_access_token');
    const expiry= sessionStorage.getItem('spotify_token_expiry');
    if(stored && expiry && Date.now()<+expiry){
        accessToken=stored; await handleSuccessfulLogin();
    }
});

/* ------------------------------------------------------------------ */
/* 6.  EVERYTHING BELOW IS YOUR ORIGINAL LOGIC (UNMODIFIED)            */
/* ------------------------------------------------------------------ */
/* -- handleAuthCallback, handleSuccessfulLogin, loadSpotifySongs,    */
/*    getOrCreateJunglPlaylist, addSongToPlaylist, loadSongs,          */
/*    createCard, setupAudioPlayer, playAudio, pauseAudio,            */
/*    setupCardInteractions, swipe helpers, stats helpers, etc.       */
/* -- copy them exactly as they already are in your current file.      */
/* ------------------------------------------------------------------ */
    </script>
</body>
</html>
